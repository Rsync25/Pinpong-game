<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ping Pong</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <style>
    body { margin: 0; background: black; color: white; font-family: sans-serif; overflow: hidden; }
    #topAd, #bottomAd {
      width: 100%; height: 60px; background: #333; text-align: center; line-height: 60px; color: #ccc;
      font-weight: bold; user-select: none;
    }
    #offlineBanner {
      color: #ffa500;
    }
    #gameCanvas { display: block; margin: 0 auto; background: #222; }
    #installBtn {
      position: fixed; bottom: 10px; right: 10px; padding: 10px 15px;
      background: #ff9800; color: black; border: none; border-radius: 8px;
      font-weight: bold; cursor: pointer; display: none;
    }
    #interstitialAd {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); color: white; display: flex;
      flex-direction: column; justify-content: center; align-items: center;
      font-size: 24px; z-index: 1000; display: none;
    }
    #interstitialAd button {
      margin-top: 20px; padding: 10px 20px; font-size: 18px; cursor: pointer;
      background: #ff9800; border: none; border-radius: 6px; color: black;
      font-weight: bold;
    }
  </style>

  <!-- Google AdSense placeholder -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</head>
<body>
  <div id="topAd">
    <!-- AdSense ad slot top -->
    <ins class="adsbygoogle"
         style="display:inline-block;width:728px;height:60px"
         data-ad-client="ca-pub-0000000000000000"
         data-ad-slot="1234567890"></ins>
    <div id="offlineTopBanner" style="display:none; color:#ffa500;">Offline Ad Banner (Top)</div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <div id="bottomAd">
    <!-- AdSense ad slot bottom -->
    <ins class="adsbygoogle"
         style="display:inline-block;width:728px;height:60px"
         data-ad-client="ca-pub-0000000000000000"
         data-ad-slot="0987654321"></ins>
    <div id="offlineBottomBanner" style="display:none; color:#ffa500;">Offline Ad Banner (Bottom)</div>
  </div>

  <button id="installBtn">Install App</button>

  <div id="interstitialAd">
    <div>Sponsored Message - Buy the best Ping Pong paddles!</div>
    <button id="closeInterstitialBtn">Close Ad</button>
  </div>

  <script>
    // Initialize AdSense ads
    try {
      (adsbygoogle = window.adsbygoogle || []).push({});
    } catch(e) {
      // fallback to offline ads if adsbygoogle is not ready
      showOfflineBanners();
    }

    // Show offline banners if AdSense fails
    function showOfflineBanners() {
      document.getElementById('offlineTopBanner').style.display = 'block';
      document.getElementById('offlineBottomBanner').style.display = 'block';
    }

    // Detect if AdSense ads are visible, else fallback after a timeout
    setTimeout(() => {
      const adsTop = document.querySelector('#topAd ins.adsbygoogle');
      const adsBottom = document.querySelector('#bottomAd ins.adsbygoogle');
      // If ads not rendered, show offline banners
      if (!adsTop || adsTop.offsetHeight === 0) showOfflineBanners();
      if (!adsBottom || adsBottom.offsetHeight === 0) showOfflineBanners();
    }, 3000);

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight - 120; // leave space for ads
    canvas.width = width;
    canvas.height = height;

    // Game variables
    let paddleHeight = 100;
    let paddleWidth = 10;
    let playerY = height / 2 - paddleHeight / 2;
    let aiY = height / 2 - paddleHeight / 2;
    let ballX = width / 2;
    let ballY = height / 2;
    let ballRadius = 10;
    let ballSpeedX = 5;
    let ballSpeedY = 5;
    let gamePaused = false;

    // Draw functions
    function drawRect(x, y, w, h, color) {
      ctx.fillStyle = color;
      ctx.fillRect(x, y, w, h);
    }
    function drawCircle(x, y, r, color) {
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2, false);
      ctx.closePath();
      ctx.fill();
    }
    function resetBall() {
      ballX = width / 2;
      ballY = height / 2;
      ballSpeedX = -ballSpeedX;
      showInterstitialAd();
    }
    function update() {
      if (gamePaused) return;
      ballX += ballSpeedX;
      ballY += ballSpeedY;
      if (ballY + ballRadius > height || ballY - ballRadius < 0) ballSpeedY = -ballSpeedY;
      if (ballX - ballRadius < paddleWidth && ballY > playerY && ballY < playerY + paddleHeight) ballSpeedX = -ballSpeedX;
      if (ballX + ballRadius > width - paddleWidth && ballY > aiY && ballY < aiY + paddleHeight) ballSpeedX = -ballSpeedX;
      if (ballX - ballRadius < 0 || ballX + ballRadius > width) resetBall();
      aiY += ((ballY - (aiY + paddleHeight / 2))) * 0.09;
    }
    function render() {
      drawRect(0, 0, width, height, 'black');
      drawRect(0, playerY, paddleWidth, paddleHeight, 'white');
      drawRect(width - paddleWidth, aiY, paddleWidth, paddleHeight, 'white');
      drawCircle(ballX, ballY, ballRadius, 'white');
    }
    function game() {
      update();
      render();
    }

    // Main loop
    setInterval(game, 1000 / 60);

    // Controls
    window.addEventListener('mousemove', e => {
      if (!gamePaused) playerY = e.clientY - paddleHeight / 2;
    });

    // PWA install button
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });
    installBtn.addEventListener('click', () => {
      installBtn.style.display = 'none';
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choice => {
        deferredPrompt = null;
      });
    });

    // Interstitial Ad Logic
    const interstitialAd = document.getElementById('interstitialAd');
    const closeBtn = document.getElementById('closeInterstitialBtn');

    function showInterstitialAd() {
      gamePaused = true;
      interstitialAd.style.display = 'flex';
    }

    closeBtn.addEventListener('click', () => {
      interstitialAd.style.display = 'none';
      gamePaused = false;
    });

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker registered', reg))
          .catch(err => console.error('SW registration failed', err));
      });
    }
  </script>
</body>
</html>
